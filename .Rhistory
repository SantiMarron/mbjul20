select(Partner_es, Reporter, Val)
nodes <- data.frame(
name=c(as.character(Mex_proc$Partner_es), as.character(Mex_proc$Reporter)) %>%
unique()
)
View(nodes)
Mex_proc <- Mex %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(-Val) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val)) %>%
left_join(Aux_paises) %>%
arrange(-Val) %>%
mutate(Reporter == "México") %>%
select(Partner_es, Reporter, Val)
nodes <- data.frame(
name=c(as.character(Mex_proc$Partner_es), as.character(Mex_proc$Reporter)) %>%
unique()
)
View(nodes)
Mex_proc <- Mex %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(-Val) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val)) %>%
left_join(Aux_paises) %>%
arrange(-Val) %>%
mutate(Reporter == "México")
Mex_proc <- Mex %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(-Val) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val)) %>%
left_join(Aux_paises) %>%
arrange(-Val) %>%
mutate(Reporter = "México") %>%
select(Partner_es, Reporter, Val)
Mex_proc <- Mex %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(-Val) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val)) %>%
left_join(Aux_paises) %>%
arrange(-Val) %>% ungroup() %>%
mutate(Reporter = "México") %>%
select(Partner_es, Reporter, Val)
nodes <- data.frame(
name=c(as.character(Mex_proc$Partner_es), as.character(Mex_proc$Reporter)) %>%
unique()
)
View(nodes)
Mexico_proc$IDsource <- match(Mexico_proc$Partner_es, nodes$name)-1
?match
Mex_proc$IDsource <- match(Mex_proc$Partner_es, nodes$name)-1
Mex_proc$IDtarget <- match(Mex_proc$Reporter, nodes$name)-1
View(Mex_proc)
Mex_proc <- Mex %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(-Val) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val)) %>%
left_join(Aux_paises) %>%
arrange(-Val) %>% ungroup() %>%
mutate(Reporter = "México") %>%
select(Partner_es, Reporter, Val)
links <- Mex_proc
nodes <- data.frame(
name=c(as.character(links$Partner_es), as.character(links$Reporter)) %>%
unique()
)
links$IDsource <- match(links$Partner_es, nodes$name)-1
links$IDtarget <- match(links$Reporter, nodes$name)-1
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE)
p
TMEC <- read_excel("Inputs/IM_NorteAmerica_ene-feb2020.xlsx")
View(TMEC)
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`))
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World")
unique(TMEC_proc$Partner)
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val)
View(TMEC_proc)
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val))
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner))
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val))
write.xlsx2(as.data.frame(TMEC_proc), "Outputs_Excel/Lista_paises.xlsx", row.names = F,
sheetName = "Lista_paises", append = F)
Lista_paises <- TMEC_proc %>% distinct(Partner_f)
View(Lista_paises)
Lista_paises <- TMEC_proc %>% ungroup() %>% distinct(Partner_f)
write.xlsx2(as.data.frame(Lista_paises), "Outputs_Excel/Lista_paises.xlsx", row.names = F,
sheetName = "Lista_paises", append = F)
Aux_paises <- read_excel("Inputs/Aux-paises.xlsx")
# Reporte SAI julio 2020 (ult. act 24 de junio 2020)
# Sankey diagrams de flujos de importacion de Mexico y EUA
gc()
library(tidyverse)
library(readxl)
library(xlsx)
library(networkD3)
##### Lectura de base de datos #####
TMEC <- read_excel("Inputs/IM_NorteAmerica_ene-feb2020.xlsx")
Aux_paises <- read_excel("Inputs/Aux-paises.xlsx")
##### Procesamiento de base para Sankey #####
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val))
Lista_paises <- TMEC_proc %>% ungroup() %>% distinct(Partner_f)
write.xlsx2(as.data.frame(Lista_paises), "Outputs_Excel/Lista_paises.xlsx", row.names = F,
sheetName = "Lista_paises", append = F)
TMEC_fin <- TMEC_proc %>%
left_join(Aux_paises)
View(TMEC_fin)
unique(TMEC_fin$Reporter)
TMEC_fin <- TMEC_proc %>%
left_join(Aux_paises) %>%
mutate(ind = case_when(Reporter == "United States of America" ~ 1,
Reporter == "Mexico" ~ 2,
Reporter == "Canada" ~ 3)) %>%
arrange(ind, -Val) %>% ungroup() %>%
mutate(Reporter_es = case_when(Reporter == "United States of America" ~ "EUA",
Reporter == "Mexico" ~ "México",
Reporter == "Canada" ~ "Canadá")) %>%
select(Partner_es, Reporter_es, Val)
View(TMEC_fin)
links <- TMEC_fin
nodes <- data.frame(
name=c(as.character(links$Partner_es), as.character(links$Reporter_es)) %>%
unique()
)
links$IDsource <- match(links$Partner_es, nodes$name)-1
links$IDtarget <- match(links$Reporter_es, nodes$name)-1
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE)
p
# Reporte SAI julio 2020 (ult. act 24 de junio 2020)
# Sankey diagrams de flujos de importacion de Mexico y EUA
gc()
library(tidyverse)
library(readxl)
library(xlsx)
library(networkD3)
##### Lectura de base de datos #####
TMEC <- read_excel("Inputs/IM_NorteAmerica_ene-feb2020.xlsx")
Aux_paises <- read_excel("Inputs/Aux-paises.xlsx")
##### Procesamiento de base para Sankey #####
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val))
Lista_paises <- TMEC_proc %>% ungroup() %>% distinct(Partner_f)
write.xlsx2(as.data.frame(Lista_paises), "Outputs_Excel/Lista_paises.xlsx", row.names = F,
sheetName = "Lista_paises", append = F)
TMEC_fin <- TMEC_proc %>%
left_join(Aux_paises) %>%
mutate(ind = case_when(Reporter == "United States of America" ~ 1,
Reporter == "Mexico" ~ 2,
Reporter == "Canada" ~ 3)) %>%
arrange(ind, -Val) %>% ungroup() %>%
mutate(Reporter_es = case_when(Reporter == "United States of America" ~ "EUA",
Reporter == "Mexico" ~ "México",
Reporter == "Canada" ~ "Canadá")) %>%
select(Partner_es, Reporter_es, Val)
##### Sankey #####
links <- TMEC_fin
# Enlistar nodos
nodes <- data.frame(
name=c(as.character(links$Partner_es), as.character(links$Reporter_es)) %>%
unique()
)
# Formato especifico de origen y destino
links$IDsource <- match(links$Partner_es, nodes$name)-1
links$IDtarget <- match(links$Reporter_es, nodes$name)-1
#Hacer la conexion
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE)
p
View(nodes)
TMEC_fin$Reporter_es
links <- TMEC_fin %>%
mutate(group = case_when(Partner_es == "China" ~ as.factor("type_a"),
Partner_es == "México" ~ as.factor("type_b"),
Parnter_es == "Canadá" ~ as.factor("type_c"),
Partner_es == "EUA" ~ as.factor("type_d"),
TRUE ~ as.factor("type_e")))
links <- TMEC_fin %>%
mutate(group = case_when(Partner_es == "China" ~ as.factor("type_a"),
Partner_es == "México" ~ as.factor("type_b"),
Partner_es == "Canadá" ~ as.factor("type_c"),
Partner_es == "EUA" ~ as.factor("type_d"),
TRUE ~ as.factor("type_e")))
View(links)
links <- TMEC_fin %>%
mutate(group = case_when(Partner_es == "China" ~ as.factor(c("type_a")),
Partner_es == "México" ~ as.factor(c("type_b")),
Partner_es == "Canadá" ~ as.factor(c("type_c")),
Partner_es == "EUA" ~ as.factor(c("type_d")),
TRUE ~ as.factor(c("type_e"))))
View(links)
links <- TMEC_fin %>%
mutate(group = case_when(Partner_es == "China" ~ as.factor(c("China")),
Partner_es == "México" ~ as.factor(c("Mex")),
Partner_es == "Canadá" ~ as.factor(c("Can")),
Partner_es == "EUA" ~ as.factor(c("Eua")),
TRUE ~ as.factor(c("Dem"))))
?as.factor
# Reporte SAI julio 2020 (ult. act 24 de junio 2020)
# Sankey diagrams de flujos de importacion de Mexico y EUA
gc()
library(tidyverse)
library(readxl)
library(xlsx)
library(networkD3)
##### Lectura de base de datos #####
TMEC <- read_excel("Inputs/IM_NorteAmerica_ene-feb2020.xlsx")
Aux_paises <- read_excel("Inputs/Aux-paises.xlsx")
##### Procesamiento de base para Sankey #####
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.95, "Otros (5% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val))
Lista_paises <- TMEC_proc %>% ungroup() %>% distinct(Partner_f)
write.xlsx2(as.data.frame(Lista_paises), "Outputs_Excel/Lista_paises.xlsx", row.names = F,
sheetName = "Lista_paises", append = F)
TMEC_fin <- TMEC_proc %>%
left_join(Aux_paises) %>%
mutate(ind = case_when(Reporter == "United States of America" ~ 1,
Reporter == "Mexico" ~ 2,
Reporter == "Canada" ~ 3)) %>%
arrange(ind, -Val) %>% ungroup() %>%
mutate(Reporter_es = case_when(Reporter == "United States of America" ~ "EUA",
Reporter == "Mexico" ~ "México",
Reporter == "Canada" ~ "Canadá")) %>%
select(Partner_es, Reporter_es, Val)
##### Sankey #####
links <- TMEC_fin
# Enlistar nodos
nodes <- data.frame(
name=c(as.character(links$Partner_es), as.character(links$Reporter_es)) %>%
unique()
)
# Formato especifico de origen y destino
links$IDsource <- match(links$Partner_es, nodes$name)-1
links$IDtarget <- match(links$Reporter_es, nodes$name)-1
#Hacer la conexion
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE)
p
# Reporte SAI julio 2020 (ult. act 24 de junio 2020)
# Sankey diagrams de flujos de importacion de Mexico y EUA
gc()
library(tidyverse)
library(readxl)
library(xlsx)
library(networkD3)
##### Lectura de base de datos #####
TMEC <- read_excel("Inputs/IM_NorteAmerica_ene-feb2020.xlsx")
Aux_paises <- read_excel("Inputs/Aux-paises.xlsx")
##### Procesamiento de base para Sankey #####
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.90, "Otros (10% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val))
Lista_paises <- TMEC_proc %>% ungroup() %>% distinct(Partner_f)
write.xlsx2(as.data.frame(Lista_paises), "Outputs_Excel/Lista_paises.xlsx", row.names = F,
sheetName = "Lista_paises", append = F)
TMEC_fin <- TMEC_proc %>%
left_join(Aux_paises) %>%
mutate(ind = case_when(Reporter == "United States of America" ~ 1,
Reporter == "Mexico" ~ 2,
Reporter == "Canada" ~ 3)) %>%
arrange(ind, -Val) %>% ungroup() %>%
mutate(Reporter_es = case_when(Reporter == "United States of America" ~ "EUA",
Reporter == "Mexico" ~ "México",
Reporter == "Canada" ~ "Canadá")) %>%
select(Partner_es, Reporter_es, Val)
##### Sankey #####
links <- TMEC_fin
# Enlistar nodos
nodes <- data.frame(
name=c(as.character(links$Partner_es), as.character(links$Reporter_es)) %>%
unique()
)
# Formato especifico de origen y destino
links$IDsource <- match(links$Partner_es, nodes$name)-1
links$IDtarget <- match(links$Reporter_es, nodes$name)-1
#Hacer la conexion
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE)
p
View(TMEC_proc)
# Reporte SAI julio 2020 (ult. act 24 de junio 2020)
# Sankey diagrams de flujos de importacion de Mexico y EUA
gc()
library(tidyverse)
library(readxl)
library(xlsx)
library(networkD3)
##### Lectura de base de datos #####
TMEC <- read_excel("Inputs/IM_NorteAmerica_ene-feb2020.xlsx")
Aux_paises <- read_excel("Inputs/Aux-paises.xlsx")
##### Procesamiento de base para Sankey #####
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.90, "Otros (10% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val))
Lista_paises <- TMEC_proc %>% ungroup() %>% distinct(Partner_f)
write.xlsx2(as.data.frame(Lista_paises), "Outputs_Excel/Lista_paises.xlsx", row.names = F,
sheetName = "Lista_paises", append = F)
TMEC_fin <- TMEC_proc %>%
left_join(Aux_paises) %>%
mutate(ind = case_when(Reporter == "United States of America" ~ 1,
Reporter == "Mexico" ~ 2,
Reporter == "Canada" ~ 3)) %>%
arrange(ind, -Val) %>% ungroup() %>%
mutate(Reporter_es = case_when(Reporter == "United States of America" ~ "EUA",
Reporter == "Mexico" ~ "México",
Reporter == "Canada" ~ "Canadá")) %>%
select(Partner_es, Reporter_es, Val)
##### Sankey #####
links <- TMEC_fin
# Enlistar nodos
nodes <- data.frame(
name=c(as.character(links$Partner_es), as.character(links$Reporter_es)) %>%
unique()
)
# Formato especifico de origen y destino
links$IDsource <- match(links$Partner_es, nodes$name)-1
links$IDtarget <- match(links$Reporter_es, nodes$name)-1
#Hacer la conexion
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE)
p
?sankeyNetwork
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE, fontSize = 10)
p
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE, fontSize = 14, fontFamily = "Century Gothic")
p
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE, fontSize = 14, fontFamily = "Century Gothic", nodeWidth = 8)
p
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE, fontSize = 14, fontFamily = "Century Gothic", nodeWidth = 15)
p
# Reporte SAI julio 2020 (ult. act 24 de junio 2020)
# Sankey diagrams de flujos de importacion de Mexico y EUA
gc()
library(tidyverse)
library(readxl)
library(xlsx)
library(networkD3)
##### Lectura de base de datos #####
TMEC <- read_excel("Inputs/IM_NorteAmerica_ene-feb2020.xlsx")
Aux_paises <- read_excel("Inputs/Aux-paises.xlsx")
##### Procesamiento de base para Sankey #####
TMEC_proc <- TMEC %>%
group_by(Year, Reporter, Partner) %>%
summarise(Val = sum(`Trade Value (US$)`)) %>%
filter(Partner != "World") %>%
arrange(Reporter, -Val) %>%
group_by(Reporter) %>%
mutate(Val_acum = cumsum(Val)) %>%
mutate(Umbral = Val_acum/sum(Val)) %>%
mutate(Partner_f = ifelse(Umbral >= 0.90, "Otros (10% restante)", Partner)) %>%
group_by(Reporter, Partner_f) %>%
summarise(Val = sum(Val))
Lista_paises <- TMEC_proc %>% ungroup() %>% distinct(Partner_f)
write.xlsx2(as.data.frame(Lista_paises), "Outputs_Excel/Lista_paises.xlsx", row.names = F,
sheetName = "Lista_paises", append = F)
TMEC_fin <- TMEC_proc %>%
left_join(Aux_paises) %>%
mutate(ind = case_when(Reporter == "United States of America" ~ 1,
Reporter == "Mexico" ~ 2,
Reporter == "Canada" ~ 3)) %>%
arrange(ind, -Val) %>% ungroup() %>%
mutate(Reporter_es = case_when(Reporter == "United States of America" ~ "EUA",
Reporter == "Mexico" ~ "México",
Reporter == "Canada" ~ "Canadá")) %>%
select(Partner_es, Reporter_es, Val)
##### Sankey #####
links <- TMEC_fin
# Enlistar nodos
nodes <- data.frame(
name=c(as.character(links$Partner_es), as.character(links$Reporter_es)) %>%
unique()
)
# Formato especifico de origen y destino
links$IDsource <- match(links$Partner_es, nodes$name)-1
links$IDtarget <- match(links$Reporter_es, nodes$name)-1
#Hacer la conexion
p <- sankeyNetwork(Links = links, Nodes = nodes,
Source = "IDsource", Target = "IDtarget",
Value = "Val", NodeID = "name",
sinksRight=FALSE, fontSize = 14, fontFamily = "Century Gothic", nodeWidth = 15)
p
